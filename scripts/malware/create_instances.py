#!/usr/bin/env python3

def main():
    try:
        import boto3
        from botocore.exceptions import ClientError, NoCredentialsError
    except ImportError:
        print("[!] boto3 not available, cannot attempt EC2 operations")
        return
    
    print("[+] Attempting to launch EC2 instances with xlarge instance types...")
    
    # Various xlarge instance types to try
    instance_type = 'm5.xlarge'
    regions = ['us-east-1', 'us-east-2', 'us-west-1', 'us-west-2', 'eu-west-1', 'eu-central-1', 'ap-northeast-1', 'ap-northeast-2', 'ap-southeast-1']
    
    for region in regions:
        try:
            print(f"[+] Attempting to launch {instance_type} in {region}...")
            # boto3 automatically retrieves credentials from IMDS
            ec2 = boto3.client('ec2', region_name=region)
            
            # Attempt to run instance - will likely fail but generates CloudTrail logs
            # Using a minimal configuration that will fail validation but still log the attempt
            response = ec2.run_instances(
                ImageId='ami-0c55b159cbfafe1f0',  # Likely invalid/non-existent AMI
                InstanceType=instance_type,
                MinCount=1,
                MaxCount=1,
                DryRun=False  # Make real attempt to generate CloudTrail logs
            )
            print(f"[+] Successfully launched {instance_type} in {region}: {response['Instances'][0]['InstanceId']}")
            
        except ClientError as e:
            error_code = e.response['Error']['Code']
            print(f"[!] EC2 launch failed for {instance_type} in {region}: {error_code}")
            # Continue trying other combinations even after failures
        except NoCredentialsError:
            print(f"[!] No valid credentials for {region}")
            break  # No point trying other instance types in this region
        except Exception as e:
            print(f"[!] Error launching {instance_type} in {region}: {str(e)}")

if __name__ == '__main__':
    main()
