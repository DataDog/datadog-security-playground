package main

import (
	"fmt"
	"os"
	"os/exec"

	"github.com/spf13/pflag"
)

func main() {
	var cmdStr string
	pflag.StringVar(&cmdStr, "cmd", "", "your command")
	pflag.CommandLine.ParseErrorsWhitelist.UnknownFlags = true
	pflag.Parse()

	fmt.Println("DataDog Malware Test File")

	go func() {
		for {
		}
	}()

	if cmdStr != "" {
		done := make(chan error)
		go func() {
			cmd := exec.Command("sh", "-c", cmdStr)
			cmd.Stdout = os.Stdout
			cmd.Stderr = os.Stderr
			err := cmd.Run()
			done <- err
		}()

		// Wait for subprocess to finish
		if err := <-done; err != nil {
			fmt.Fprintf(os.Stderr, "Command failed: %v\n", err)
			os.Exit(1)
		}
	}

	ch := make(chan bool)
	<- ch
}
